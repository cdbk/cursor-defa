#!/bin/bash

# Cursor Rules Migration Script - .cursorrules to .mdc
# Copyright (c) 2025 Kentaro Kitagawa
# MIT License - https://opensource.org/licenses/MIT

echo "ğŸ”„ Cursor Rules Migration - .cursorrules to .mdc"
echo "================================================"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
BACKUP_DIR="backup_$(date +%Y%m%d_%H%M%S)"
echo "ğŸ“ Creating backup directory: $BACKUP_DIR"
mkdir -p "$BACKUP_DIR"

# ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
echo "ğŸ’¾ Backing up current files..."
cp -r rules "$BACKUP_DIR/"
cp -r archive_rules "$BACKUP_DIR/"
cp setup-cursor-rules.sh "$BACKUP_DIR/"

# ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã®å¤‰æ›´
echo "ğŸ”„ Renaming .cursorrules files to .mdc..."

# rules/defa/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
for file in rules/defa/*.cursorrules; do
    if [ -f "$file" ]; then
        newfile="${file%.cursorrules}.mdc"
        mv "$file" "$newfile"
        echo "  âœ… $file â†’ $newfile"
    fi
done

# rules/simple/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
for file in rules/simple/*.cursorrules; do
    if [ -f "$file" ]; then
        newfile="${file%.cursorrules}.mdc"
        mv "$file" "$newfile"
        echo "  âœ… $file â†’ $newfile"
    fi
done

# archive_rules/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
for file in archive_rules/*.cursorrules; do
    if [ -f "$file" ]; then
        newfile="${file%.cursorrules}.mdc"
        mv "$file" "$newfile"
        echo "  âœ… $file â†’ $newfile"
    fi
done

echo ""
echo "ğŸ“ Updating references in documentation files..."

# ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®å‚ç…§ã‚’æ›´æ–°
find . -name "*.md" -o -name "*.sh" | while read file; do
    if [ -f "$file" ]; then
        # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ
        cp "$file" "$file.backup"
        
        # .cursorrules ã‚’ .mdc ã«ç½®æ›
        sed -i '' 's/\.cursorrules/\.mdc/g' "$file"
        
        echo "  âœ… Updated references in $file"
    fi
done

# setup-cursor-rules.sh ã®æ›´æ–°
echo ""
echo "ğŸ”§ Updating setup script..."

# setup-cursor-rules.sh ã®æ›´æ–°
sed -i '' 's/\.cursorrules/\.mdc/g' setup-cursor-rules.sh

echo ""
echo "âœ… Migration completed successfully!"
echo "ğŸ“ Backup created in: $BACKUP_DIR"
echo ""
echo "ğŸ“‹ Next steps:"
echo "1. Review the changes in the backup directory"
echo "2. Test the updated setup script"
echo "3. Update any external documentation if needed"
echo "4. Commit the changes to version control" 